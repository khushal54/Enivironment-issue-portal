<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Eco Admin Control Center</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Segoe UI}
body{background:#050d0b;color:white;padding:20px;background-image:url("/bg-main.jpg"); background-size:cover;
}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:25px;flex-wrap:wrap;gap:10px}
h1{color:#52ff9a;font-size:28px}
.stats{display:flex;gap:15px;flex-wrap:wrap}

.stat{
padding:10px 18px;
border-radius:10px;
font-weight:bold;
background:rgba(255,255,255,0.08);
cursor:pointer;
}

.container{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(300px,1fr));
gap:20px
}

.card{
background:rgba(255,255,255,0.08);
border-radius:15px;
padding:20px;
border-left:8px solid gray
}

.high{border-left-color:#ff4d4d}
.medium{border-left-color:#ffb703}
.low{border-left-color:#52ff9a}

.tag{
font-size:12px;
font-weight:bold;
padding:3px 10px;
border-radius:20px;
display:inline-block;
margin-bottom:10px
}

.tag.high{background:#ff4d4d33;color:#ff4d4d}
.tag.medium{background:#ffb70333;color:#ffb703}
.tag.low{background:#52ff9a33;color:#52ff9a}

img{width:100%;border-radius:10px;margin-top:10px}

.fileLabel{
display:block;
margin-top:6px;
font-size:12px;
opacity:0.7
}

button{
margin-top:10px;
padding:8px 12px;
background:#52ff9a;
border:none;
border-radius:6px;
cursor:pointer;
}
</style>
</head>

<body>

<header>
<h1>üåç Eco Admin Dashboard</h1>
<div class="stats">
<div class="stat" onclick="filterReports('all')" id="total">Total: 0</div>
<div class="stat" onclick="filterReports('high')" id="high">High: 0</div>
<div class="stat" onclick="filterReports('medium')" id="medium">Medium: 0</div>
<div class="stat" onclick="filterReports('low')" id="low">Low: 0</div>
</div>
</header>

<div class="container" id="reports"></div>

<script>
let allReports=[];

async function loadReports(){
const res=await fetch("/api/reports");
allReports=await res.json();
updateStats(allReports);
renderReports(allReports);
}

function updateStats(data){
let h=0,m=0,l=0;
data.forEach(r=>{
if(r.severity==="High")h++;
if(r.severity==="Medium")m++;
if(r.severity==="Low")l++;
});
total.innerText="Total: "+data.length;
high.innerText="High: "+h;
medium.innerText="Medium: "+m;
low.innerText="Low: "+l;
}

function renderReports(data){
const box=document.getElementById("reports");
box.innerHTML="";

data.forEach(r=>{
box.innerHTML+=`
<div class="card ${r.severity.toLowerCase()}">
<span class="tag ${r.severity.toLowerCase()}">${r.severity}</span>
<h3>${r.type}</h3>
<p>${r.desc}</p>
${r.img?`<img src="${r.img}">`:""}

<label style="display:block;margin-top:8px">
<input type="file" onchange="handleFile(this,${r.id})">
</label>

<button onclick="resolveReport(${r.id})">Resolve</button>
</div>`;
});
}

let proofFiles={};

function handleFile(input,id){
if(input.files.length>0){
proofFiles[id]=input.files[0];
}
}

async function resolveReport(id){

const file=proofFiles[id];

if(!file){
alert("Upload Proof First");
return;
}

const reader=new FileReader();
reader.onload=async e=>{
await fetch("/resolve-report",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({id,proof:e.target.result})
});
alert("Resolved!");
loadReports();
};
reader.readAsDataURL(file);
}

function filterReports(level){
if(level==="all")renderReports(allReports);
else renderReports(allReports.filter(r=>r.severity.toLowerCase()===level));
}

loadReports();
setInterval(loadReports,5000);
</script>


</body>
</html>
