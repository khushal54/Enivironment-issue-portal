<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Eco Admin Control Center</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Segoe UI}
body{
  background:#050d0b;
  color:white;
  padding:20px;
  background-image:url("https://static.vecteezy.com/system/resources/previews/022/448/299/large_2x/save-earth-day-poster-environment-day-nature-green-ai-generative-glossy-background-images-tree-and-water-free-photo.jpg")
}

header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:25px;
  flex-wrap:wrap;
  gap:10px;
}

h1{color:#52ff9a;font-size:28px;}

.stats{display:flex;gap:15px;flex-wrap:wrap;}

.stat{
  padding:10px 18px;
  border-radius:10px;
  font-weight:bold;
  background:rgba(255,255,255,0.08);
  backdrop-filter:blur(8px);
  cursor:pointer;
  transition:0.2s;
}
.stat:hover{background:#52ff9a33}

.container{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(300px,1fr));
  gap:20px;
}

.card{
  background:rgba(255,255,255,0.08);
  border-radius:15px;
  padding:20px;
  backdrop-filter:blur(10px);
  border-left:8px solid gray;
  position:relative;
  animation:fade 0.4s ease;
}

@keyframes fade{
  from{opacity:0;transform:translateY(10px)}
  to{opacity:1;transform:translateY(0)}
}

.high{border-left-color:#ff4d4d}
.medium{border-left-color:#ffb703}
.low{border-left-color:#52ff9a}

.tag{
  font-size:12px;
  font-weight:bold;
  padding:3px 10px;
  border-radius:20px;
  display:inline-block;
  margin-bottom:10px;
}

.tag.high{background:#ff4d4d33;color:#ff4d4d}
.tag.medium{background:#ffb70333;color:#ffb703}
.tag.low{background:#52ff9a33;color:#52ff9a}

img{
  width:100%;
  border-radius:10px;
  margin-top:10px;
}

.time{
  font-size:12px;
  opacity:0.6;
  margin-top:10px;
}

.empty{
  text-align:center;
  opacity:0.5;
  margin-top:50px;
}
</style>
</head>

<body>

<header>
  <h1>üåç Eco Admin Dashboard</h1>
  <div class="stats">
    <div class="stat" onclick="filterReports('all')" id="total">Total: 0</div>
    <div class="stat" onclick="filterReports('high')" id="high">High: 0</div>
    <div class="stat" onclick="filterReports('medium')" id="medium">Medium: 0</div>
    <div class="stat" onclick="filterReports('low')" id="low">Low: 0</div>
  </div>
</header>

<div class="container" id="reports"></div>
<div class="empty" id="emptyMsg">No Reports Yet</div>

<script>
let allReports = [];

async function loadReports(){
  const res = await fetch("/api/reports");
  allReports = await res.json();
  updateStats(allReports);
  renderReports(allReports);
}

function updateStats(data){
  let high=0,medium=0,low=0;

  data.forEach(r=>{
    const level = r.severity.toLowerCase();
    if(level==="high") high++;
    if(level==="medium") medium++;
    if(level==="low") low++;
  });

  document.getElementById("total").innerText="Total: "+data.length;
  document.getElementById("high").innerText="High: "+high;
  document.getElementById("medium").innerText="Medium: "+medium;
  document.getElementById("low").innerText="Low: "+low;
}

function renderReports(data){
  const container=document.getElementById("reports");
  const emptyMsg=document.getElementById("emptyMsg");
  container.innerHTML="";

  if(data.length===0){
    emptyMsg.style.display="block";
    return;
  } else {
    emptyMsg.style.display="none";
  }

  data.reverse().forEach(r=>{
    const level=r.severity.toLowerCase();

    container.innerHTML+=`
      <div class="card ${level}">
        <span class="tag ${level}">${r.severity} Priority</span>
        <h3>${r.type}</h3>
        <p><b>Location:</b> ${r.loc}</p>
        <p>${r.desc}</p>
        ${r.img ? `<img src="${r.img}">` : ""}
        <div class="time">${r.time}</div>
      </div>
    `;
  });
}

function filterReports(level){
  if(level==="all"){
    renderReports(allReports);
  } else {
    const filtered = allReports.filter(r => r.severity.toLowerCase()===level);
    renderReports(filtered);
  }
}

loadReports();
setInterval(loadReports,5000);
</script>

</body>
</html>
